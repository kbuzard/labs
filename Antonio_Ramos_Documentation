
06/01/2020
- I had to work with ICT to resolve a corrupted file and disentagle conflicting dependancie. The corrupted file was renamed "C:\Apps-SU\Anaconda3-old" and ICT created new file "C:\Apps-SU\Anaconda3" with reinstall of Anaconda and all packages that had been installed to "C:\Apps-SU\Anaconda3-old" this includes the shapely package installed earlier but not geopandas 

- after working with ICT spyder4 was not opening, so the files located at "C:\Users\YOUR_USER_NAME\.spyder-py3\"   " C:\Users\YOUR_USER_NAME\.ipython" "C:\Users\YOUR_USER_NAME\.matplotlib"   were all deleted with copies placed in "C:\Users\aramosri\documents"

06/02/2020
- spyder 4 now opens correctly

- upon opening spyder i was asked if I wanted to install "Kite" which "provides better and more accurate code completion in its editor when using packages like matplotlib numpy and pandas (Which are all being used in our python scripts) -- will ask prof buzard if she believes we should install. NOTE - we decided not to use "Kite". 

- again trying to see if i can get "G:\MAX-Filer\Collab\Labs-kbuzard-S18\Admin\kfunctions\K-function Local_3Stage Trial" script to run past the importation of modules, decided to begin by downloading the packages as prompted at the top of the script. This was being done because due to conflicting module dependancies, as noted in line 3, I was unable to install the packges needed to run the "K-function Local_3Stage.py" program which is the principal modeling program for this project.

- as directed at the top of "K-function Local_3Stage.py" I attemped to download package "plotnine" with command "conda install -c conda-forge plotnine" in the anaconda command prompt 

- install successful, package downloaded to C:\Apps-SU\Anaconda3\pkgs

- attempted to download package "geopandas" with command "conda install -c conda-forge geopandas"

- package "geopandas" installed to C:\Apps-SU\Anaconda3\pkgs

06/04/2020
- attempted to run "G:\MAX-Filer\Collab\Labs-kbuzard-S18\Admin\kfunctions\K-function Local_3Stage Trial" and was able to complete the process all modules imported, simulations completed, and shapefiles saved. Note this was just a trial program and did not run on any significant data or compute calculations. More problems with handaling data files will arise later as I transition to running the "K-function Local_3Stage.py" progam. 


06/05/2020
(The next steps in the documentation are redundant because I was working on the wrong files. Skip to line 96 of documentation)
- attempted to run script "G:\MAX-Filer\Collab\Labs-kbuzar-S18\Admin\kfunctions\K-function Local_Scipy.py" in spyder and a syntax error was retunred
"
runfile('G:/MAX-Filer/Collab/Labs-kbuzard-S18/Admin/kfunctions/K-function Local_Scipy.py', wdir='G:/MAX-Filer/Collab/Labs-kbuzard-S18/Admin/kfunctions')
  File "G:\MAX-Filer\Collab\Labs-kbuzard-S18\Admin\kfunctions\K-function Local_Scipy.py", line 185
    PVALS = []
        ^
SyntaxError: invalid syntax
"

- after further investigation, and communication with professor Buzard, the error appears to be on line 182. When running that line individually the following error is returned...
"SyntaxError: unexpected EOF while parsing"

- after reviewing stack overflow i noticed that the error was arising due to a missing parentheses so I added a parentheses to line 18.  previous code looked like this ....
"pvals = cnts.multiply((1/(simulations + 1.))"
new code....
"pvals = cnts.multiply((1/(simulations + 1.)))"

-now when running line 182 individually we get a the following error
"AttributeError: 'numpy.ndarray' object has no attribute 'multiply'"

- when attempting to run with line 185 no error occurs

- when attempting to run entire script error occurs at line 13
"ModuleNotFoundError: No module named 'shapefile'"

06/06/2020
- searched for module shapefile in  "C:\Python4Arc\ArcGIS\Lib\site-packages" and "C:\App-SU\Anaconda3\pkgs" module not found in either will investigate what it does and possibly download it

- after reviewing stackoverflow and not finding the shapefile module anywhere on the computer I am going to attempt to install the package that shapefile module comes in, using the following command in the anaconda prompt window
"conda inatall -c conda-forge pyshp"-forge

- package "pyshp" which contains module "shapefile" installed successfully to "C:\App-SU\Anaconda3\pkgs"

- attempted to run program again with the console returning the following message
"
Traceback (most recent call last):

  File "G:\MAX-Filer\Collab\Labs-kbuzard-S18\Admin\kfunctions\K-function Local_Scipy.py", line 41, in <module>
    pointFeatures = shapefile.Reader(pFC)

  File "C:\Apps-SU\Anaconda3\lib\site-packages\shapefile.py", line 553, in __init__
    self.load(args[0])

  File "C:\Apps-SU\Anaconda3\lib\site-packages\shapefile.py", line 646, in load
    raise ShapefileException("Unable to open %s.dbf or %s.shp." % (shapeName, shapeName))

ShapefileException: Unable to open G:\MAX-Filer\Collab\Labs-kbuzard-S18\Admin\CARR\California\Base Data\GoodLabs.dbf or G:\MAX-Filer\Collab\Labs-kbuzard-S18\Admin\CARR\California\Base Data\GoodLabs.shp.
"

- found file "G:\MAX-Filer\Collab\Labs-kbuzard-S18\Admin\CARR\California\Base Data\GoodLabs.shp" however when I tried to open it with python code I used earlier, I got the following error message
"
DriverError: G:\MAX-Filer\Collab\Labs-kbuzard-S18\Admin\CARR\California\Base Data\GoodLabs.shp: No such file or directory
"

06/07/2020
- noticed that within the file "G:\MAX-Filer\Collab\Labs-kbuzard-S18\Admin\CARR\California\Base Data" there are updated versions of the "GoodLabs.shp" and "GoodLabs.dbf" named "GoodLabs_New.shp" and "GoodLabs_New.dbf" will update the file names within the K-function Local_Scipy.py script to the new names.

- rewrote the path name on line 39 to account for the updated GoodLabs.
old od - "pFC = r"G:\MAX-Filer\Collab\Labs-kbuzard-S18\Admin\CARR\California\Base Data\GoodLabs.shp""
new code - pFC = r"G:\MAX-Filer\Collab\Labs-kbuzard-S18\Admin\CARR\California\Base Data\GoodLabs_New.shp""

- ipython console displays the run file command but then doesnt return anything and seems to freeze since it doesnt let me run anyother scripts, will attempt to restart and run again

- again no response within the console and unabe to run other scripts

- reverted path name to original - " pFC = r"G:\MAX-Filer\Collab\Labs-kbuzard-S18\Admin\CARR\California\Base Data\GoodLabs.shp""
and got shapefile exception again when trying to run the script 

06/08/2020
- realized I was working on the wrong script and started working on the K-function Local_3Stage.py located inG:\MAX-Filer\Collab\Labs-kbuzard-S18\Admin\kfunctions

- once I started working on the correct script I realized that the Will's dosumentation is not up to date and does not reference the same files as the script does. So, I created an excell spreadsheet to list all the files mentioned by Will in his documentation in an attemtp to better understand where everything was coming from, what it did, and how it should function with the python scripts. 


- emailed Will asking if he had any more updated documentation. Will responded with the most comprehensive documentation that he has, however it still does not mention the files being refrenced by the K-function Local_3Stage.py script. 

06/09/2020
- I will now begin doing a line by line analysis of the K-function Local_3Stage.py script to better understand what it is doing with the data files being referenced 

- All modules necessary for running K-function Local_3Stage.py installed onto computer to  C:\Apps-SU\Anaconda3\pkgs. Able to fully run trial version of 3 stage script, K-function Local_3Stage Trial.py, however when proceeding to try and run the K-function Local_3Stage.py script all modules are imported and programs runs effectively until it stars performing an endless loop of simulations at line 125. Printing the following over and over again "SIMULATION 1 THREW an error" followed by "SIMULATION 2 THREW an error" and it continues increasing like that ad inifinitum.

06/10/2020
- going to open up data files referenced in K-function Local_3Stage.py in ArcMap to see if the data they contain properly corresponds to the data structures being described in the K-function Local_3Stage.py script 

- cannot open ArcMap from windows start bar, continue getting notification that the application is not responding. Will attempt to open from the command prompt window  

- finally able to open arcmap by starting it from the start bar and waiting for the program to repsond 

- when adding the data that is referenced in the K-function Local_3Stage.py program to a blank map in ArcMap the block data (CA_Block_New.shp) appears well, however, the zip data (CA_ZCTA_New.shp) does not appear on the map and it seems that when I add it as a data layer nothing changes on the map, furthermore, the labs data (GoodLabs_New.shp) does not appears as points on the block data map but as one point far away from the block data map. 

- evaluated attribute tables to ensure that the proper data column names in the table were being referenced by the K-function Local_3Stage.py program. All data table names are correctly referenced, however, there is also another attribute "geometry" which is being listed on lines 39-41 and I am not sure what that is doing, it does not appear in any of the attribute tables from the data files. 

- when running line by line analysis of K-function Local_3Stage.py I again get the infinite simulation loops when running lines 104-137 together. Upon further review I did not get any errors running lines 104-119 together, but it does not get past 50 percent complete on the simluations, have to interupt program with "control C". Could be because I am running the lines independent of any data. Now, when I run lines 120-128 together I get "SIMULATION 1 Threw an error". Moreover, when I run line 122 in K-fucntion Local_3Stage.py, I get the following error...
  "File "G:\MAX-Filer\Collab\Labs-kbuzard-S18\Admin\kfunctions\Three Stage K-functions\kfunction_3Stage.py", line 49, in countSimulation
    fsFeatures['FS_PROBS'] = fsFeatures[[fieldFS]] / float(sum(fsFeatures[fieldFS]))

TypeError: unsupported operand type(s) for +: 'int' and 'str'"

-(now working in kfunction_3Stage.py script) when running lines 42-49 (so as to include the definition of "fsFeatures") no error occurs and script runs perfectly fine. Moreover, when running the entire function definied as "countSimulation" (lines 42-87) no error is retunred and function executes. Similarly when running the entire function defined as "pointSimulation" (which is referenced in line 122 of K-function Local_3Stage.py) no error is returned and function executes. So I am confused as to what is sending us into this infinite loop. I believe it might have to do with the data we are feeding into the programs but I am not sure why. As mentioned above the attribute names being referenced coincide between the program and the data. 

- Will mentions having come across a similar problem in his documentation on lines 143-145. I sent him an email asking if he remembers how he got around that problem, his solution is not articulated in the documentation. 

06/11/2020
- after communicating with Will, we were still not able to get documentation which aligns with the data referenced in the python scripts. Documentation that Will sent over was the same as what was already in the github repository. File not downloaded since it is the same as what is in the git repo. 

- finished filling in Data & Script File Table which contains a list of all the files mentioned by Will Heikoff in his documentation, or utilized by the python script "K-function Local_3Stage.py" saved it in G:\MAX-Filler\Collab\Labs-kbuzard-S18\Admin . 

- will now go through the following programs which Will Heikoff wrote to change aspects of the data so that it would work with the python scripts.
1. ZIPS_Tot_Emp.r 
2. CA_WAC_Transformation.R
3. ZCTA_Manufa_Trans.R
4. ZCTA_GoodLabs_Trans.py
5. ZCTA_Manufa_Trans.py 
6. GoodLabs_Trans.py
(more complete descriptions avaliable in Data & Script File Table located at G:\MAX-Filer\Collab\Labs-kbuzard-S18\Admin) 

- discovered that the two of the three data files, GoodLabs_New.shp and CA_ZCTA_Man.shp, from the K-function Local_3Stage.py script come from one python script, "ZCTA_GoodLabs_Trans.py" (located at "G:\MAX-Filer\Collab\Labs-kbuzard-S18\Admin\kfunctions\Three Stage K-functions\ZCTA_GoodLabs_Trans.py") 

- ZCTA_GoodLabs_Trans.py changes the PCS for GoodLabs.shp and exports GoodLabs_New.shp. GoodLabs_New.shp is identical to GoodLabs.shp except the PCS is changed to NAD 1983 Contiguous USA Albers. 

- ZCTA_GoodLabs_Trans.py also also reads a csv file (DEC_00_SF3_DP3_with_ann.csv) and joins it with an imported shapefile (tl_2010_06_zcta500.shp) changes the CRS and then exports CA_ZCTA_Man.shp

- all other R and python scripts do not seem to be relevant to the data that is currently being used by the K-function Local_3Stage.py script. However, it is not clear where the data file CA_Block_New.shp came from which is the third data file being read into the K-function Local_3Stage.py script. 

- In the folder located at "G:\MAX-Filer\Collab\Labs-kbuzard-S18\Admin\Block Level Analysis" I found two programs that might be related to CA_Block_New.shp 
 1. CA_Block_Trans.py
 2. CA_WAC_Trans.py 
both programs are written August 8th but there is no documentation for why 

- CA_Block_Trans.py has a note that says "Need to figure out how to change shapefile from ANSI 1252 to UTF-8 encoding." Not sure if this was ever done will look for more up to date file. After examining the code it looks like CA_Block_Trans.py is the same as CA_WAC_Trans.py except CA_Block_Trans.py changes the geometry and CRS. CA_Block_Trans.py reads in a csv.gz file (ca_wac_S000_JT00_2002.csv.gz) and and joins it with an imported shapefile (CA_block_2000.shp) then changes the geometry and CRS and exports a shapefile (CA_2000_Tot_Emp.shp) however, this is not the block data file which is being read into K-function Local_3Stage.py. 

- found the origin of ca_wac_S000_JT00_2002.csv.gz, https://lehd.ces.census.gov/data/lodes/LODES7/ca/wac/  (ask prof. buzard if she can help clarify what the content of this file is) 

eing able to remake the zipcode with manufacturing employment shapefil
06/13/2018
- returning to the issue GoodLabs_New.shp not plotting anything when added as a layer to a blank ArcMap map, when I tested GoodLabs.shp the original file, the points do appear plotted on the map. This issue is what I started to explore when trying to reslove the infinite loop issue mentioned on line 107 & 120

-changed projected coordinate system (PCS) for GoodLabs.shp in ArcGis to make it compatibale with the PCS of CA_Block_New (NAD 1983 Contiguous USA Albers) the outputted file with the updated PCS is GoodLabs_Project.shp located with the above mentioned files at "G:\MAX-Filer\Research\Labs-kbuzard-S18\Admin\CARR\California\Base Data" (GoodLabs_Project.shp becomes irrelevant later on as I come up with a better way to solve the geometry issues) 

- at this point both GoodLabs.shp and CA_Block_New.shp open and are plotted correctly in arcmap. the zip code data file hoewver is not projecting properly in arcmap. Again, here I am assuming that whatever is causing this projection error may also be contributing to the infinite loop mentioned on lines 107 & 120

-Trying to remake the ZCTA file with manufacturing data to see if projection and coordinate issues can be solves but having a lot of trouble doing it. When I add the manufa emp data in python then I have issues with the CRS in arcgis where either
1. i change the CRS in python but then it doesnt project the data properly in arcgis
2. i do only the join in python and try to change the CRS in arcgis, once I change the CRS again the data ceases to be projected 
3. i try to do the join in arcgis and then attempt to change CRS, can't even do the join
- the goal right now is to get all the data projected onto arcgis properlly, because if the data isnt projecting properly then whatever is causing that issue in arcgis might also be causing the infinite simulation loop in the Local 3Stage program

- wrote program ZCTA_JOIN_Manufa_EMP.py to join the manufacuturing and employment data to the zipcode shapefile 

- using ZCTA_JOIN_Manufa_EMP.py I joined DEC_00_SF3_DP3_with_ann.csv to tl_2010_06_zcta500.shp and exported the result as CA_ZCTA_Man_New.shp located at "G:\MAX-Filer\Collab\Labs-kbuzard-S18\Admin\Block Level Analysis" (ZCTA_Man_New.shp becomes irrelevant as I find a better way to produce the zip code data later on)  

- CA_ZCTA_Man_New projects onto ArcMap when placed by itself but when GoodLabs_Project.shp and CA_Block_New.shp are added as a layers then it becomes clear that the data from the join is messing with the scaling and size of the map.  

6/14/2020
- redownloaded Zip code data from https://www.census.gov/cgi-bin/geo/shapefiles/index.php?year=2010&layergroup=ZIP+Code+Tabulation+Areas and saved it in "G:\MAX-Filer\Collab\Labs-kbuzard-S18\Admin\Block Level Analysis" as tl_2010_06_zcta500_New.shp. I did this to check and see if the issue with our CRS might be originating from some corruption in the old zip code data file

- file saved as a zipped file, unzipped using 7zip and files are now located at "G:\MAX-Filer\Collab\Labs-kbuzard-S18\Admin\Block Level Analysi\tl_2010_06_zcta500_New"

- using arcgis I joined the file with CA_ZCTA_Man_New.shp to create a file that contained the zipcode and manufacturing employment data. Then using arcgis I deleted all the repeated data from the join and only left the manufacturing employment data. and the original data from tl_2010_06_zcta500_New.shp

- exported the join as CA_ZCTA_Manufa_Project.shp and saved it in  "G:\MAX-Filer\Collab\Labs-kbuzard-S18\Admin\Block Level Analysis"

- projected CA_ZCTA_Manufa_Project.shp onto a blank arcgis map, then added the layers of CA_Block_New.shp and GoodLabs.shp and all three projected together. However, when I tried to run the python script I still got the same infinite loop of similations error. 

- most likly problem is that we are only changing the PCS and not the CRS.


6/15/2020

- updated Data & Script File Table to include file types. 

- realized that Will Heihoff's program for changing CRS and geometry is only changing PCS metadata and not changing CRS, will rewrite program. 

-rewrote program as ZCTA_Trans_Trial.py however when I try to run it I get the following error "
  File "C:\Apps-SU\Anaconda3\lib\site-packages\pyproj\__init__.py", line 362, in __new__
    return _proj.Proj.__new__(self, projstring)

  File "_proj.pyx", line 129, in _proj.Proj.__cinit__

RuntimeError: b'no arguments in initialization list'"

- after substantial online investigation it seems that the problem is due to the location of the package data for "pyproj". Not entirely sure how to fix this, Danel said he would run the program on his machine to see if the same error arises. Waiting on his response. 

6/22/2020
- going to uninstall and reinstall pyproj to see if this corrects the data error 

- to remove pyproj I entered "conda remove pyproj"  into conda command prompt

- got the following warnering but ignored it because after reviewing the file, it seems to just be fonts text file. "WARNING conda.gateways.disk.delete:unlink_or_rename_to_trash(140): Could not remove or rename C:\Apps-SU\Anaconda3\Lib\site-packages\matplotlib\mpl-data\fonts\ttf\DejaVuSans.ttf.  Please remove this file manually (you may need to reboot to free file handles)"

- then reinstalled from the conda forge channel using "conda install -c conda-forge pyproj" in the conda command prompt 

- attribute error recieved when attempeting to install pyproj 

- will uninstall all packages being utilized by ZCTA_Trans_Trial.py and then reinstall 

- attempted to uninstall "pandas" package through conda prompt with "conda remove pandas" however, machine requesting Administrator access again, will resolve issue with ITS 

- Question for Prof. Buzard. Do you know why we need to change the CRS in all these data files, and why did we decide upon the CRS we did? 

6/24/2020
- ICT able to remove  packages. Will now reinstall them. 

- entered "conda install -c conda-forge geopandas" into anaconda command prompt to install geopandas package

- installation successful. package saved to " C:\Apps-SU\Anaconda3"

- entered "conda install -c conda-forge pandas" into anaconda command prompt window to install pandas package. Command prompt returned "package already installed" 

- entered "conda install -c conda-forge r-sys" into anaconda command prompt to install sys package

- installation successful. package saved to " C:\Apps-SU\Anaconda3"

- entered "conda install -c conda-forge numpy" into anaconda command prompt to install numpy package

- tried to open Spyder but the program is not running. Will resolve issue with ICT (Still hasn't been resloved. After ICT got back to me last week I wasn't able to look at the program again till today. I am again in contact with them to try and resolve the issue) 

07/01/2020
- ICT uninstalled and reinstalled Spyder, program now opening. 

- geopandas and shapely packages unsinstalled when spyder was uninstalled and must be reinstalled will reinstall through anaconda prompt window. 

- entered "conda install -c conda-forge geopandas" into Anaconda command prompt to instal geopandas 

- when installing the package the environment could not be solved and package failed to install. ICT told me I might have problems with this, I have reached out to them and will update once resolved. 

07/02/2020
- ICT able to install shapley but not geopandas. ICT reports that geopandas requires certain dependancies and a special configuration to install that they were unable to do and thus could not install geopandas. 

- investigating stackoverlow/exchange/github to see what others say about installing geopandas

7/08/2020
- following recommendations from stack overflow, I will attempt to downlaod geopandas without pulling it from the conda forge channel. 

- entered "conda install geopandas" into anaconda command prompt window 

07/13/2020
- unable to resolve configuration of packages to allow for installing of geopandas. 

- will attempt to see if I can make the programs run on my machine at home. If so then the issue is in the VM and we can just start fresh with a new VM. 

- failed to install geopandas onto personal machine with "conda install -c conda-forge geopandas" due to similar dependency conflicts as on the VM. 

- now attempting to install geopandas from general channel using "conda install geopandas" again on my personal computer

- again the packagage cannot be downloaded due to conflicts in the dependancies

7/15/2020

- will create new python environment in anaconda command prompt to try and get around the conflicting package problem presnt in root environment. 

- created python environemt in anaconda command prompt using the following "conda create --name programTrial python=3.7" named the environment "programTrial" 

- activated new environment with "conda activate programTrial"

- set up ArcGis Python API, allowing python to run ArcGis, by installing the apprporitate packages into the new programTrial environment. Used "conda instal -c esri arcgis" 

- will now install geopandas and plotnine

- entered "conda install -c conda-forge plotnine" into anaconda command prompt 

- package installed successfully 

- entered "conda install -c conda-forge geopandas" into anaconda command prompt 

- package installed successfully 

- installed spyder dependencies into new environment by opening the "Anaconda Naviagtor" from the start menu. clicking on the environments tab then selecting the programTrial environment, then going to the home tab, then clicking install under the spyder tab. 

- opened spyder and ran program "K-function Local_3Stage.py" got infinite simulation error loop again. 

- will repeat all previous steps from today's documentation on my personal computer to see if infinite loop simulation error occurs. Did this to see if the source of the error might be something in the set up of the VM I am using. Ultimately, it was not and the true source of the error.

7/27/2020
- reviewing data in "DEC_00_SF3_DP3_with_ann.csv" and noticed that a few cells with 0 manufacturing employment have ZCTAs with letters "XX" and "HH" in them. will do a find a replece to remove all alphabetic letters from Id2 column and delete all data columns not being utilized by 3stage program. Saved resulting csv file as "DEC_00_SP3_DP3_with_ann2.csv". Note. this changes the data type of the columns into objects must revert types to integer and strings in python script 

- DEC_00_SP3_DP3_with_ann2.csv no longer has extra header so I changed line 21 of ZCTA_Manufa_Trans.py from "skiprows = 1" to "skiprows = 0"

- will add the following code to ZCTA_Manufa_Trans.py to handle the change in data type and revert data back to int data type 
"
convert_dict = {'ZCTA5CE00' : str, 'Manufa_Emp' : int}
Tab2 = Tab2.astype(convert_dict)
"

- saved shapefile as "CA_ZCTA_Man2.0.shp"

- changed pathway reference in Local_3Stage_kfunction.py to import new shapefile CA_ZCTA_Man2.0.shp

- ran program Local_3Stage_kfunction.py for 2 simulations and it successfully saved a shapefile "Manufa_Emp_C000_Points.shp". Infinite simulation loop error now solved. 

7/28/2020
- ran program successfully for 499 simulations. Shapefile exported. However, there is an issue with the GoodLabs_New.shp file where the labs are not projecting correctly in ArcGis. Problem corrected by using GoodLabs_Project.shp instead. Files will be changed later on for files produced by python scripts to automate any necessary data manipuation in R or ArcGis 

8/1/2020
- when going into arcgis to plot the outputed files, the resulting shapefile created by the 3Stage_Local.py program is not the clusters but just an exported points file. 

- Problems left to resolve - 1. no cluster file is being generated even after 499 simulations. 2. the find and replace done on the excel file needs to be automated in python. 3. the code that produces the labs data file is not producing files which project correctly.

8/8/2020

- installying arcpy to python envinronment "programTrial" using following command in anaconda command prompt "conda install -c esri arcpy". arcpy is a python package with inergrated commands for recalculating the feature extent of a shapefile. It will be used to solve issue with the lab data in GoodLabs_New.shp not projecting correctly. 

- error arcpy cannot run on python 3.7 so I will create a new environment that uses python 3.6 by running the following command in anaconda terminal prompt "conda create --name programTrial3.6 python=3.6" 

- will install all packages used in environmtne "programTrial" and also install arcpy 

8/9/2020
- during creation of environment "programTrial3.6" multiple conflicts arose from the installation of arcpy 

- will begin determining which order to install packages so that conflicts do not arise

8/11/2020
- removed the programTrial3.6 environment and created new environment "3Stage_Locacl_Run_env" where I install packages and programs in the following order 
  1. Spyder 4.0.1. (Installed through the anaconda navigator) 
  2. arcpy (anaconda command prompt command "conda install -c esri arcpy")
  3. plotnine (anaconda command prompt "conda install -c conda-forge plotnine") 
  4. geopandas (anaconda command prmopt "conda install-c conda-forge geopandas") 
- all modules and packages installed successfully

- when running scripts that import arcpy, i am getting an error that says "no module named 'arcpy')


8/12/2020
- created copy of "3Stage_Local_Run_env" environment on my personal computer to see if I can run the arcpy there

- arcpy module succesfully loads in spyder on my personal computer

- added the following code to ZCTA_Manufa_Trans.py script to recalculate feature extent..
"#recalculate feature extent
feature_class = geo_df
arcpy.RecalculateFeatureClassExtent_management(feature_class)"

- ZCTA_Manufa_Trans.py runs successfully with new code and exports shapefile (on my personal computer)

- will check if the feature extent now matches the exent of the original data using the following code...
"# Create a Describe object from the shapefile
desc = arcpy.Describe(geo_df)

# Print dataset properties
print ("Dataset Type:" + desc.datasetType)

extent = desc.Extent
print ("Extent:")
print ("  %s: %f, %s: %f, %s: %f, %s: %f" % ("XMin", extent.XMax, "XMax", extent.XMax, 
                                            "YMin", extent.YMin, "YMax", extent.YMax))
print ("MExtent: " + desc.MExtent)
print ("ZExtent: " + desc.ZExtent)

SR = desc.spatialReference
print (SR.name)"

- feature extent now matches original data, however, problems arising in the use of arcpy on VM and alternate solution for projection issue may need to be found. 

8/13/2020

- trying to now resolve why arcpy isn't being imported on the VM. I will remove programTrial3.6 and try again with new environment 3Stage_Local_Run_env, following same install procedures as I did on my personal computer

- same problem occuring as well as other. There is probably an issue with our python instalation and I will ask ICT to remove and reinstall python, anaconda, and arcgis

8/14/2020

- discoverd why the feature extent is being changed when creating the shapefile for lab and ZCTA data. The command we are using to change the CRS is compressing the data in the shapefiles and not recalculating it with the new CRS. Hence, using the recalculate command stretches the compressed data back out.

- will now use "geo_df.to_crs" instead of "geo_df.set_crs" to change the coordinate systems in both ZCCTA_Manufa_Trans.py and GoodLabs_Trans.py scripts. If this new command works, then arcpy is not needed. (commands worked, arcpy not needed) 

- got the following error back "RuntimeError: b'no arguments in initialization list'" when running ZCTA_Manufa_Trans.py with new code geo_df.to_crs. 

- my guess is this is related to the problems in the python installation because it is the same issue I was facing when I was having problems with the python installation last month

8/16/2020
- finally emailed ICT about python installation

- investigating the block data information now to understand where it came from and how it was structured when it was made

- unsure about what program was used to merge the two files that are refereced in Will's "What I Did" document

8/19/2020
- back to resolving the projection issue for labs data and ZCTA data. 

- new python, arcgis, and anaconda installation completed 

- will create new envrionment in anaconda command prmopt to handle packages needed for 3Stage_Local.py and all other pyhton scripts. Entered the following command into anaconda command prompt "conda create --name 3Stage_Local python=3.7". I will download the following packages and modules in the following order... 
1. install Spyder 4.1.4 through the anaconda navigator 
2. install "arcgis" to run arcgis processes in python ("conda install -c esri arcgis") 
3. install "plotnine" required to run 3Stage_Local.py ("conda install -c conda-forge plotnine") 
4. install "geopandas" geospatial mapping and management modules to handle shapefiles in python ("conda install -c conda-forge geopandas") 
I am not installing arcpy because it appears (see line 449) that a previous change to the way in which the coordinate system is set will avoid the data compression which results in the feature extent changing. Be sure to install packages and programs in the order listed above or you will have conflicts with the dependencies and spyder will not install properly 

- Changed code in GoodLabs_Trans.py to use geo_df.to_crs instead of geo_df.set_crs. 

- both ZCTA_Manufa_Trans.py and (GoodLabs_Trans.py are now running successfully and exporting shapefiles. 

- all data sets now projecting correcting. The three data sets that are being used by Local_3Stage.py are CA_Block_New.shp, CA_ZCTA_Data.shp, and CA_Lab_Data.shp. Both CA_ZCTA_Data.shp and CA_Lab_Data.shp come from python scripts which programatized arcgis commands (ZCTA_Manufa_Trans.py and GoodLabs_Trans.py respectively). 

8/20/2020

- ran program K-function Local_3Stage.py for 999 simulations with data mentioned in line 477 of this documentation

8/23/2020
- point file exported but again no cluse file exported. When investigating data attribute table of the point file outputted by the k-function program it appears with resulting cluster significance either at 0 or 999. 

- renamed GoodLabs_Trans.py to GoodLabs_CRS_Trans.py

- cleaned up block level analysis folder. Now it only contains the files that are being used to create the data used by the k-fucntion program and the data itself.

8/24/2020

- used Will's program CA_Block_Trans.py and edited the code so that it would set the CRS correctly and perform a join on the data needed for CA_Block_New.shp

- all data preparation now automated in python

- need to schedule a zoom call to work on the issue with the k-fucntion local program not exporting a cluster file

8/30/2020

- still troubleshooting lack of exported cluster file from "K-function 3Stage_Local.py" program. Will test out the follwoing ideas from Jake Carr.
1. Double check that the lab coordinates are not too truncated, simimlar issue caused problems earlier on.

2. make sure line 94 of the "K-function Local_3Stage.py" is working correctly. Meaning, it is correctly calculating the numnber of labs withitn the .5 1 5 and 10 mile radius of each lab. 

9/2/2020
- no issue found with the truncation of the xy coordinates

- opening CA_Block_New in ArcMap to check the cluster counts for labs at .5 1 5 and 10 mile radius.

- opening obsk data table in spyder variable expolorer to view if lab cluster counts match lab cluster countsI found in arcgis.

- lab cluster counts do not match

- will begin exploring how cluster counts are created

- cluster counts are created by .kfunction() in kfunction_3stage

- trying to understand how counts are created.

9/6/2020
- opening CA_Block_New in ArcMap to check the cluster counts for labs at .5 1 5 and 10 mile radius.

- opening obsk data table in spyder variable expolorer to view if lab cluster counts match lab cluster countsI found in arcgis.

- lab cluster counts do not match

- will begin exploring how cluster counts are created

- cluster counts are created by .kfunction() in kfunction_3stage

- trying to understand how counts are created.

9/9/2020
- I am having trouble replicating the creation of the array which holds these point counts when I try to use simplified data. I believe this may mean there is an issue in the code on lines 130-133 of kfunction_3stage.py. (no issue found in code).

- There may be an issue with the way in which the distance matrix is being calculated. This issue might be on the code side or the data side and is the one I am currently investigating.

- after reviewing the distance matrix through the variable explorer in spyder the data appears to be incorrect and it is largely either 0 or *** and has little to no variation in between

- reviewing how distance matrix is calculated

- no issue with matrix construction fuctinos so the issue must stem from the data being fed into the function

- issue identified with the way in which the XY coordinates are being imported. For some reason, the coordinates imported do not match the coordinates from the data as seen in arcgis.

- exploring the data import to better understand why the coordinates do not match

- on line 40 of kfunction Local_3Stage.py we define a variable,
  "pFeatures = gpd.read_file(points).filter(['REF_ID', 'SIC', 'geometry'], axis = 1)".
  
- Here "geometry" contains the data for the XY coordinates. However, the data it contains when reviewed in Spyder's variable explorer does not match the data from arcgis that is visible in the data attribute table. 

9/10/2020

- "geometry" is an geopandas array created when a we use geopandas to import a shapefile. The array contains the information for the structure of the geometric objects within the shapefile. This is defined by a shape and coordinates of the shapes centroid or the coordinates of the point if the shape is a point.

- our CA_Lab_Data.shp file has centroid locations saved under the XY coordinates, however, geopandas is constructing its own centroid locations for the geometry index

- could resolve issue by either changing the reference variables on lines 39 77 and 78, or I can try to correct the way in which geopandas is creating geometries for the file.

9/11/2020

- corrected all geometries by changing the code in GoodLabs_CRS_Trans.py. I deleted lines 18 - 21 and replaced it with the following code...

  "# Create GeoDataFrame with new CRS
     geometry = pFeatures.geometry
     geo_df2 = gpd.GeoDataFrame(data2, geometry = geometry)
     geo_df2 = geo_df2.to_crs('epsg:5070') 
     geo_df2 = geo_df2.set_geometry(geometry)"

- now the CRS is set properly so that when geopandas reads in the file during runtime of K-function Local_3Stage.py it will be able to properly construct the coordinate pairs under geomentry.

- when running program no cluster file is exported and point resutls appear to still be the same as before where we are either getting 0.01 or 1 for the cluster significance

9/12/2020
